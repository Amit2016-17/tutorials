<!DOCTYPE html>

<html>
  <head>
    <meta
      name="viewport"
      content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes"
    />
    <meta name="theme-color" content="#4F7DC9" />
    <meta charset="UTF-8" />
    <title>Build an app plugin</title>
    <link
      rel="stylesheet"
      href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono"
    />
    <link
      rel="stylesheet"
      href="//fonts.googleapis.com/icon?family=Material+Icons"
    />
    <link
      rel="stylesheet"
      href="https://storage.googleapis.com/grafana-tutorials-staging/codelab-elements/codelab-elements.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://storage.googleapis.com/grafana-tutorials-staging/google-codelab.css"
    />
    <style>
      .success {
        color: #1e8e3e;
      }
      .error {
        color: red;
      }
    </style>
  </head>
  <body>
    <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
    <google-codelab
      codelab-gaid=""
      id="build-an-app-plugin"
      title="Build an app plugin"
      environment="web"
      feedback-link="https://github.com/grafana/tutorials/issues/new"
    >
      
      <google-codelab-step label="Introduction" duration="1">
        <p>An app plugin lets you offer a complete monitoring experience, by bundling plugins along with custom pages. Custom pages lets you add sign-up forms, documentation, or even control panels to manage external services.</p>
<h2 is-upgraded>What you&#39;ll build</h2>
<p>In this tutorial, you&#39;ll build an app plugin that bundles a data source, panel, dashboard, as well as a custom page.</p>
<h2 class="checklist" is-upgraded>What you&#39;ll learn</h2>
<ul class="checklist">
<li>How to build an app plugin.</li>
</ul>
<h2 is-upgraded>What you&#39;ll need</h2>
<ul>
<li>Grafana version 7.0+</li>
<li>NodeJS</li>
<li>yarn</li>
</ul>


      </google-codelab-step>
      
      <google-codelab-step label="Set up your environment" duration="1">
        <p>Before you can get started building plugins, you need to set up your environment for plugin development.</p>
<p>To discover plugins, Grafana scans a <em>plugin directory</em>, the location of which depends on your operating system.</p>
<p>1. Create a directory called <code>grafana-plugins</code> in your preferred workspace.</p>
<p>2. Find the <code>plugins</code> property in the Grafana configuration file and set the <code>plugins</code> property to the path of your <code>grafana-plugins</code> directory. Refer to the <a href="https://grafana.com/docs/grafana/latest/installation/configuration/#plugins" target="_blank">Grafana configuration documentation</a> for more information.</p>
<pre><code>[paths]
plugins = &#34;/path/to/grafana-plugins&#34;
</code></pre>
<p>Restart Grafana if it&#39;s already running, to load the new configuration.</p>
<h2 is-upgraded>Alternative method: Docker</h2>
<p>If you don&#39;t want to install Grafana on your local machine, you can use <a href="https://www.docker.com" target="_blank">Docker</a>. To set up Grafana for plugin development using Docker, run the following command:</p>
<pre><code>docker run -d -p 3000:3000 -v &#34;$(pwd)&#34;/grafana-plugins:/var/lib/grafana/plugins --name=grafana grafana/grafana
</code></pre>
<p>Since Grafana only loads plugins on start-up, you need to restart the container whenever you add or remove a plugin.</p>
<pre><code>docker restart grafana
</code></pre>



      </google-codelab-step>
      
      <google-codelab-step label="Create a new plugin" duration="1">
        <p>Tooling for modern web development can be tricky to wrap your head around. While you certainly can write you own webpack configuration, for this guide, you&#39;ll be using <em>grafana-toolkit</em>.</p>
<p><a href="https://github.com/grafana/grafana/tree/master/packages/grafana-toolkit" target="_blank">grafana-toolkit</a> is a CLI application that simplifies Grafana plugin development, so that you can focus on code. The toolkit takes care of building and testing for you.</p>
<p>1. In the plugin directory, create a panel plugin from template using the <code>plugin:create</code> command:</p>
<pre><code>npx grafana-toolkit plugin:create my-plugin
</code></pre>
<p>2. Change directory.</p>
<pre><code>cd my-plugin
</code></pre>
<p>3. Download necessary dependencies:</p>
<pre><code>yarn install
</code></pre>
<p>4. Build the plugin:</p>
<pre><code>yarn dev
</code></pre>
<p>5. Restart the Grafana server for Grafana to discover your plugin.</p>
<p>6. Open Grafana and go to <strong>Configuration</strong> -&gt; <strong>Plugins</strong>. Make sure that your plugin is there.</p>
<p>By default, Grafana logs whenever it discovers a plugin:</p>
<pre><code>INFO[01-01|12:00:00] Registering plugin       logger=plugins name=my-plugin
</code></pre>



      </google-codelab-step>
      
      <google-codelab-step label="Anatomy of a plugin" duration="1">
        <p>Plugins come in different shapes and sizes. Before we dive deeper, let&#39;s look at some of the properties that are shared by all of them.</p>
<p>Every plugin you create will require at least two files: <code>plugin.json</code> and <code>module.ts</code>.</p>
<h2 is-upgraded>plugin.json</h2>
<p>When Grafana starts, it scans the plugin directory for any subdirectory that contains a <code>plugin.json</code> file. The <code>plugin.json</code> file contains information about your plugin, and tells Grafana about what capabilities and dependencies your plugin needs.</p>
<p>While certain plugin types can have specific configuration options, let&#39;s look at the mandatory ones:</p>
<ul>
<li><code>type</code> tells Grafana what type of plugin to expect. Grafana supports three types of plugins: <code>panel</code>, <code>datasource</code>, and <code>app</code>.</li>
<li><code>name</code> is what users will see in the list of plugins. If you&#39;re creating a data source, this is typically the name of the database it connects to, such as Prometheus, PostgreSQL, or Stackdriver.</li>
<li><code>id</code> uniquely identifies your plugin, and should start with your GitHub username, to avoid clashing with other plugins.</li>
</ul>
<p>To see all the available configuration settings for the <code>plugin.json</code>, refer to the <a href="https://grafana.com/docs/grafana/latest/plugins/developing/plugin.json/" target="_blank">plugin.json Schema</a>.</p>
<h2 is-upgraded>module.ts</h2>
<p>After discovering your plugin, Grafana loads the <code>module.ts</code> file, the entrypoint for your plugin. <code>module.ts</code> exposes the implementation of your plugin, which depends on the type of plugin you&#39;re building.</p>
<p>Specifically, <code>module.ts</code> needs to expose an object that extends <a href="https://github.com/grafana/grafana/blob/08bf2a54523526a7f59f7c6a8dafaace79ab87db/packages/grafana-data/src/types/plugin.ts#L124" target="_blank">GrafanaPlugin</a>, and can be any of the following:</p>
<ul>
<li><a href="https://github.com/grafana/grafana/blob/08bf2a54523526a7f59f7c6a8dafaace79ab87db/packages/grafana-data/src/types/panel.ts#L73" target="_blank">PanelPlugin</a></li>
<li><a href="https://github.com/grafana/grafana/blob/08bf2a54523526a7f59f7c6a8dafaace79ab87db/packages/grafana-data/src/types/datasource.ts#L33" target="_blank">DataSourcePlugin</a></li>
<li><a href="https://github.com/grafana/grafana/blob/45b7de1910819ad0faa7a8aeac2481e675870ad9/packages/grafana-data/src/types/app.ts#L27" target="_blank">AppPlugin</a></li>
</ul>



      </google-codelab-step>
      
      <google-codelab-step label="App plugins" duration="0">
        <p>Coming soon ...</p>


      </google-codelab-step>
      
      <google-codelab-step label="Congratulations" duration="0">
        <p>Congratulations, you made it to the end of this tutorial!</p>


      </google-codelab-step>
      
    </google-codelab>

    <script src="https://storage.googleapis.com/grafana-tutorials-staging/codelab-elements/native-shim.js"></script>
    <script src="https://storage.googleapis.com/grafana-tutorials-staging/codelab-elements/custom-elements.min.js"></script>
    <script src="https://storage.googleapis.com/grafana-tutorials-staging/codelab-elements/prettify.js"></script>
    <script src="https://storage.googleapis.com/grafana-tutorials-staging/codelab-elements/codelab-elements.js"></script>
    <script src="//support.google.com/inapp/api.js"></script>
  </body>
</html>
